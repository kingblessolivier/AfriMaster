
{% extends 'admin/admin_base/admin_base.html' %}

{% block content %}

<div class="main-content  animate-fade-in">
    <div class="dashboard-hero card-glass p-4 mb-4 animate-slide-up">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h2 class="mb-1 gradient-text">Welcome back, Admin ðŸ‘¼</h2>
                <p class="text-muted mb-0">Overview of your platform â€” quick insights and recent activity.</p>
            </div>
            <div class="text-end">
                <a href="{% url 'adding_update' %}" class="btn btn-sm btn-accent animate-pulse">Create update</a>
                <a href="{% url 'adding_user' %}" class="btn btn-sm btn-outline-secondary ms-2 animate-hover">Add user</a>
            </div>
        </div>
    </div>

    <!-- Metrics -->
    <div class="metrics-grid mb-4">
        <div class="metric-card animate-card-hover">
            <div class="metric-icon bg-soft-primary"><i class="fa fa-building fa-lg"></i></div>
            <div>
                <div class="metric-value">{{ property_total|default:'0' }}</div>
                <div class="metric-label">Properties</div>
            </div>
        </div>
        <div class="metric-card animate-card-hover">
            <div class="metric-icon bg-soft-success"><i class="fa fa-users fa-lg"></i></div>
            <div>
                <div class="metric-value">{{ tenant_total|default:'0' }}</div>
                <div class="metric-label">Tenants</div>
            </div>
        </div>
        <div class="metric-card animate-card-hover">
            <div class="metric-icon bg-soft-warning"><i class="fa fa-envelope fa-lg"></i></div>
            <div>
                <div class="metric-value">{{ message_total|default:'0' }}</div>
                <div class="metric-label">Unread Messages</div>
            </div>
        </div>
        <div class="metric-card animate-card-hover">
            <div class="metric-icon bg-soft-info"><i class="fa fa-user-tie fa-lg"></i></div>
            <div>
                <div class="metric-value">{{ owner_total|default:'0' }}</div>
                <div class="metric-label">Owners</div>
            </div>
        </div>
        <div class="metric-card animate-card-hover">
            <div class="metric-icon bg-soft-indigo"><i class="fa fa-file-contract fa-lg"></i></div>
            <div>
                <div class="metric-value">{{ total_enquiries|default:'0' }}</div>
                <div class="metric-label">Open Enquiries</div>
            </div>
        </div>
        <div class="metric-card animate-card-hover">
            <div class="metric-icon bg-soft-success"><i class="fa fa-check-circle fa-lg"></i></div>
            <div>
                <div class="metric-value">{{ read_enquiries|default:'0' }}</div>
                <div class="metric-label">Resolved Enquiries</div>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <div class="col-lg-7">
            <div class="card p-3 animate-slide-up">
                <div class="card-header d-flex justify-content-between align-items-center mb-2">
                    <h5 class="mb-0 gradient-text">User Registrations</h5>
                    <small class="text-muted">Last 7 days</small>
                </div>
                <div class="chart-container p-2">
                    <canvas id="lineChart"></canvas>
                </div>
            </div>

            <div class="card mt-3 p-3 animate-slide-up">
                <div class="card-header d-flex justify-content-between align-items-center mb-2">
                    <h5 class="mb-0 gradient-text">Messages & Enquiries</h5>
                    <div>
                        <a href="{% url 'message_list' %}" class="btn btn-sm btn-outline-primary animate-hover">View messages</a>
                        <a href="{% url 'admin_inquiries' %}" class="btn btn-sm btn-outline-secondary ms-2 animate-hover">View enquiries</a>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <div class="list-group">
                            <div class="list-group-item animate-fade-in">
                                <div class="d-flex justify-content-between">
                                    <div><strong>{{ unread_messages.count|default:'0' }}</strong> Unread Messages</div>
                                    <div class="text-success">+{{ unread_enquiries|default:'0' }}</div>
                                </div>
                            </div>
                            <div class="list-group-item animate-fade-in">
                                <div class="d-flex justify-content-between">
                                    <div><strong>{{ read_messages.count|default:'0' }}</strong> Read Messages</div>
                                    <div class="text-muted">&nbsp;</div>
                                </div>
                            </div>
                            <div class="list-group-item animate-fade-in">
                                <div class="d-flex justify-content-between">
                                    <div><strong>{{ archived_enquiries|default:'0' }}</strong> Archived</div>
                                    <div class="text-muted">&nbsp;</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <table class="table table-sm table-hover animate-fade-in">
                            <thead class="table-light">
                                <tr><th>From</th><th>Subject / Snippet</th><th>Date</th></tr>
                            </thead>
                            <tbody>
                            {% for msg in all_messages|slice:":5" %}
                                <tr class="animate-fade-in">
                                    <td>{{ msg.name|default:msg.email }}</td>
                                    <td>{{ msg.message|truncatechars:60 }}</td>
                                    <td>{{ msg.created_at|date:"M d" }}</td>
                                </tr>
                            {% empty %}
                                <tr><td colspan="3" class="text-muted">No recent messages</td></tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-5">
            <div class="card p-3 mb-3 animate-slide-up">
                <div class="card-header d-flex justify-content-between align-items-center mb-2">
                    <h5 class="mb-0 gradient-text">Platform Overview</h5>
                    <small class="text-muted">Quick stats</small>
                </div>
                <div class="row">
                    <div class="col-6">
                        <div class="stat-box p-3 mb-2 animate-card-hover">
                            <div class="stat-value">{{ property_total|default:'0' }}</div>
                            <div class="stat-label">Properties</div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="stat-box p-3 mb-2 animate-card-hover">
                            <div class="stat-value">{{ total_enquiries|default:'0' }}</div>
                            <div class="stat-label">Enquiries</div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="stat-box p-3 mb-2 animate-card-hover">
                            <div class="stat-value">{{ tenant_total|default:'0' }}</div>
                            <div class="stat-label">Tenants</div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="stat-box p-3 mb-2 animate-card-hover">
                            <div class="stat-value">{{ owner_total|default:'0' }}</div>
                            <div class="stat-label">Owners</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card p-3 animate-slide-up">
                <div class="card-header d-flex justify-content-between align-items-center mb-2">
                    <h5 class="mb-0 gradient-text">Recent Properties</h5>
                    <a href="{% url 'admin_properties' %}" class="small animate-hover">View all</a>
                </div>
                <ul class="list-group list-group-flush">
                    {% for p in property_list|slice:":6" %}
                        <li class="list-group-item d-flex justify-content-between align-items-center animate-fade-in">
                            <div>
                                <strong>{{ p.name }}</strong>
                                <div class="text-muted small">{{ p.address|truncatechars:40 }}</div>
                            </div>
                            <span class="badge bg-primary animate-pulse">{{ p.number_of_units }}</span>
                        </li>
                    {% empty %}
                        <li class="list-group-item text-muted">No properties yet</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>

</div>

<!-- JS dependencies -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    // Line Chart for User Registrations (7 days)
    const ctxLine = document.getElementById('lineChart').getContext('2d');
    const lineChart = new Chart(ctxLine, {
        type: 'line',
        data: {
            labels: {{ daily_user_registration_dates|safe }},
            datasets: [{
                label: 'Daily Registrations',
                data: {{ daily_user_registration_counts|safe }},
                backgroundColor: 'linear-gradient(90deg, rgba(123, 97, 255, 0.1), rgba(0, 180, 255, 0.1))',
                borderColor: 'rgba(123, 97, 255, 1)',
                borderWidth: 2,
                tension: 0.4,
                fill: true,
                pointRadius: 4,
                pointBackgroundColor: '#fff',
                pointBorderColor: 'rgba(123, 97, 255, 1)',
                pointBorderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: {
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    titleColor: '#fff',
                    bodyColor: '#fff'
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: { color: 'rgba(0,0,0,0.05)' },
                    ticks: { color: '#6c757d' }
                },
                x: {
                    grid: { color: 'rgba(0,0,0,0.05)' },
                    ticks: { color: '#6c757d' }
                }
            },
            animation: {
                duration: 2000,
                easing: 'easeInOutQuart'
            }
        }
    });

    // Enhanced animated counters with easing
    document.querySelectorAll('.metric-value, .stat-value').forEach(el => {
        const end = parseInt(el.textContent || '0', 10);
        let cur = 0;
        const step = Math.max(1, Math.round(end / 50));
        const iv = setInterval(() => {
            cur += step;
            if (cur >= end) {
                cur = end;
                clearInterval(iv);
            }
            el.textContent = cur;
        }, 20);
    });

    // Add stagger animation for cards
    const cards = document.querySelectorAll('.metric-card, .stat-box');
    cards.forEach((card, index) => {
        card.style.animationDelay = `${index * 0.1}s`;
    });
</script>

{% endblock %}
